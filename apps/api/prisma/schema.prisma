generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  VENDOR
  ADMIN
}

enum DiscountType {
  FLAT
  PERCENTAGE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

model User {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  email     String    @unique
  password  String
  name      String?
  phone     String?
  role      Role      @default(USER)
  bookings  Booking[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model ServiceCategory {
  id           String                @id @default(auto()) @map("_id") @db.ObjectId
  slug         String                @unique // e.g., 'venues', 'catering'
  translations ServiceCategoryTranslation[]
  services     VendorService[]
}

model ServiceCategoryTranslation {
  id          String          @id @default(auto()) @map("_id") @db.ObjectId
  categoryId  String          @db.ObjectId
  language    String          // 'en' or 'ta'
  name        String
  category    ServiceCategory @relation(fields: [categoryId], references: [id])
  @@unique([categoryId, language])
}

model VendorService {
  id           String                   @id @default(auto()) @map("_id") @db.ObjectId
  categoryId   String                   @db.ObjectId
  category     ServiceCategory          @relation(fields: [categoryId], references: [id])
  vendorId     String // In a real app, relation to User or Vendor profile
  price        Float
  city         String
  translations VendorServiceTranslation[]
  bookings     BookingItem[]
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
}

model VendorServiceTranslation {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  serviceId   String        @db.ObjectId
  language    String        // 'en' or 'ta'
  name        String
  description String?
  service     VendorService @relation(fields: [serviceId], references: [id])
  @@unique([serviceId, language])
}

model Discount {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  code        String       @unique
  type        DiscountType
  value       Float
  maxUses     Int // e.g., 10 for "First 10 Customers"
  usedCount   Int          @default(0)
  city        String?      // Optional: if null, applies globally
  isActive    Boolean      @default(true)
  bookings    Booking[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Booking {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  userId      String        @db.ObjectId
  user        User          @relation(fields: [userId], references: [id])
  totalAmount Float
  discountId  String?       @db.ObjectId
  discount    Discount?     @relation(fields: [discountId], references: [id])
  status      BookingStatus @default(PENDING)
  items       BookingItem[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model BookingItem {
  id        String        @id @default(auto()) @map("_id") @db.ObjectId
  bookingId String        @db.ObjectId
  booking   Booking       @relation(fields: [bookingId], references: [id])
  serviceId String        @db.ObjectId
  service   VendorService @relation(fields: [serviceId], references: [id])
  price     Float
  date      DateTime
}

model Review {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String?
  rating    Int
  comment   String
  approved  Boolean  @default(false)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
